<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康運動指導士ビンゴゲーム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
        }
        
        .cell-hover:hover {
            transform: scale(1.05);
        }
        
        .cell-completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
        
        .cell-selected {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-color: #60a5fa;
            box-shadow: 0 10px 25px rgba(96, 165, 250, 0.3);
            transform: scale(1.05);
        }
        
        .bingo-celebration {
            animation: bounce 0.6s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -30px, 0);
            }
            70% {
                transform: translate3d(0, -15px, 0);
            }
            90% {
                transform: translate3d(0, -4px, 0);
            }
        }
        
        .option-button {
            transition: all 0.2s ease;
        }
        
        .option-button:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .option-selected {
            border-color: #059669;
            background-color: #ecfdf5;
            color: #065f46;
        }
    </style>
</head>
<body>
    <div id="app" class="max-w-6xl mx-auto p-6 bg-gradient-to-br from-green-50 via-blue-50 to-teal-50 min-h-screen">
        <!-- ヘッダー -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center gap-3 mb-4">
                <div class="p-3 bg-gradient-to-r from-green-600 to-teal-600 rounded-full">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 9V5a3 3 0 0 0-6 0v4"/>
                        <rect x="2" y="9" width="20" height="12" rx="2"/>
                        <circle cx="12" cy="15" r="2"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent">
                        健康運動指導士ビンゴ
                    </h1>
                    <p class="text-lg font-medium text-gray-700">専門知識学習ゲーム</p>
                </div>
            </div>
            <p class="text-gray-600">3つ揃えて健康運動のプロフェッショナルを目指そう！</p>
        </div>

        <!-- スコア表示 -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/20 text-center">
                <div id="score" class="text-2xl font-bold text-green-600">0</div>
                <div class="text-sm text-gray-600">正解数</div>
            </div>
            <div class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/20 text-center">
                <div id="attempts" class="text-2xl font-bold text-blue-600">0</div>
                <div class="text-sm text-gray-600">挑戦数</div>
            </div>
            <div class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/20 text-center">
                <div id="bingo-lines" class="text-2xl font-bold text-teal-600">0</div>
                <div class="text-sm text-gray-600">ビンゴライン</div>
            </div>
            <div class="bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/20 text-center">
                <div id="accuracy" class="text-2xl font-bold text-orange-600">0%</div>
                <div class="text-sm text-gray-600">正答率</div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
            <!-- ビンゴボード -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                            <path d="M7 4V2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v2"/>
                            <path d="M7 4h10l1 9H6l1-9Z"/>
                        </svg>
                        ビンゴボード
                    </h2>
                    <button id="new-game" class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-lg hover:from-green-600 hover:to-teal-600 transition-all duration-200 shadow-lg">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                            <path d="M3 3v5h5"/>
                        </svg>
                        新しいゲーム
                    </button>
                </div>

                <div id="bingo-board" class="grid grid-cols-3 gap-3 bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-xl border border-white/30">
                    <!-- ビンゴセルはJSで生成 -->
                </div>

                <!-- ビンゴ達成表示 -->
                <div id="bingo-celebration" class="hidden bg-gradient-to-r from-green-400 to-teal-500 text-white p-6 rounded-2xl shadow-xl text-center bingo-celebration">
                    <div class="flex items-center justify-center gap-3 mb-3">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="8" r="6"/>
                            <path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/>
                        </svg>
                        <h3 class="text-2xl font-bold">🎉 ビンゴ達成！ 🎉</h3>
                    </div>
                    <p id="bingo-message" class="text-lg">おめでとうございます！健康運動指導士としての知識をマスター！</p>
                    <div class="mt-4">
                        <span id="final-accuracy" class="text-sm bg-white/20 px-3 py-1 rounded-full"></span>
                    </div>
                </div>
            </div>

            <!-- 問題エリア -->
            <div id="question-area" class="space-y-4">
                <!-- 待機状態 -->
                <div id="waiting-state" class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-8 border border-white/30 text-center">
                    <div class="mb-4">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-green-500 mb-4">
                            <path d="M9 12l2 2 4-4"/>
                            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9"/>
                            <path d="M16 12c0 2.21-1.79 4-4 4s-4-1.79-4-4 1.79-4 4-4"/>
                        </svg>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">問題を選択してください</h3>
                        <p class="text-gray-600">ビンゴボードのマスをクリックして健康運動指導士の知識に挑戦しよう！</p>
                    </div>
                    <div class="bg-gradient-to-r from-green-100 to-teal-100 rounded-lg p-4">
                        <p class="text-sm text-gray-700">💡 ヒント: 運動生理学、解剖学、栄養学、運動処方など幅広い分野から出題されます！</p>
                    </div>
                </div>

                <!-- 問題表示 -->
                <div id="question-state" class="hidden bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 border border-white/30">
                    <div class="mb-4">
                        <div id="question-tags" class="flex items-center gap-2 mb-3"></div>
                        <h3 id="question-title" class="text-lg font-bold text-gray-800 mb-4"></h3>
                        <p id="question-text" class="text-gray-700 mb-6"></p>
                    </div>
                    <div id="options-container" class="space-y-3"></div>
                    <button id="submit-answer" class="w-full mt-6 py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-lg font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:from-green-600 hover:to-teal-600 transition-all duration-200 flex items-center justify-center gap-2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/>
                        </svg>
                        回答する
                    </button>
                </div>

                <!-- 結果表示 -->
                <div id="result-state" class="hidden rounded-2xl shadow-xl p-6 border border-white/30">
                    <div id="result-content" class="p-6 rounded-xl text-center">
                        <div id="result-icon" class="flex items-center justify-center gap-2 mb-4"></div>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-2">正解：</p>
                            <p id="correct-answer" class="font-medium text-gray-800"></p>
                        </div>
                        <div id="explanation" class="mb-4 p-3 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-800"></p>
                        </div>
                        <button id="next-question" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200">
                            次の問題へ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 健康運動指導士の問題データ
        const allCards = [
            {
                id: 1,
                category: '運動生理学',
                question: '1分間の最大心拍数の推定式で最も一般的なものは？',
                answer: '220 - 年齢',
                options: [
                    '220 - 年齢',
                    '200 - 年齢',
                    '210 - 年齢',
                    '230 - 年齢'
                ],
                correctIndex: 0,
                difficulty: 'easy',
                explanation: 'カルボーネン法の基礎となる最大心拍数の推定式です。ただし個人差があることも重要です。'
            },
            {
                id: 2,
                category: '解剖学・運動学',
                question: '大腿四頭筋を構成する筋肉で正しくないものは？',
                answer: '大腿二頭筋',
                options: [
                    '大腿直筋',
                    '外側広筋',
                    '中間広筋',
                    '大腿二頭筋'
                ],
                correctIndex: 3,
                difficulty: 'medium',
                explanation: '大腿四頭筋は大腿直筋、外側広筋、内側広筋、中間広筋の4つで構成されます。大腿二頭筋はハムストリングスの一部です。'
            },
            {
                id: 3,
                category: '栄養学・栄養指導',
                question: '糖質1gあたりのエネルギー量は？',
                answer: '4kcal',
                options: [
                    '4kcal',
                    '7kcal',
                    '9kcal',
                    '2kcal'
                ],
                correctIndex: 0,
                difficulty: 'easy',
                explanation: '糖質とタンパク質は1g=4kcal、脂質は1g=9kcal、アルコールは1g=7kcalです。'
            },
            {
                id: 4,
                category: '運動処方・プログラム設計',
                question: '有酸素運動の強度を示すMETsで、速歩（時速6km）の強度は？',
                answer: '4.0METs',
                options: [
                    '2.0METs',
                    '4.0METs',
                    '6.0METs',
                    '8.0METs'
                ],
                correctIndex: 1,
                difficulty: 'medium',
                explanation: '速歩（時速6km/h）は4.0METs相当です。1METs=安静時の酸素消費量です。'
            },
            {
                id: 5,
                category: '疾病予防・健康管理',
                question: 'メタボリックシンドロームの診断基準で、男性の腹囲の基準値は？',
                answer: '85cm以上',
                options: [
                    '80cm以上',
                    '85cm以上',
                    '90cm以上',
                    '95cm以上'
                ],
                correctIndex: 1,
                difficulty: 'easy',
                explanation: '日本の基準では男性85cm以上、女性90cm以上が腹囲の基準値とされています。'
            },
            {
                id: 6,
                category: 'トレーニング科学',
                question: '筋力トレーニングの原理で「過負荷の原理」が示すものは？',
                answer: '通常より大きな負荷をかける必要性',
                options: [
                    '毎日同じ負荷で行う重要性',
                    '通常より大きな負荷をかける必要性',
                    '負荷を徐々に減らしていく方法',
                    '休息を多く取る重要性'
                ],
                correctIndex: 1,
                difficulty: 'medium',
                explanation: '過負荷の原理（オーバーロード原理）は、トレーニング効果を得るために通常より大きな負荷が必要であることを示します。'
            },
            {
                id: 7,
                category: '心理学・行動変容',
                question: '行動変容ステージモデルで、運動を定期的に行っている期間が6ヶ月未満の段階は？',
                answer: '実行期',
                options: [
                    '前熟考期',
                    '熟考期',
                    '実行期',
                    '維持期'
                ],
                correctIndex: 2,
                difficulty: 'hard',
                explanation: '実行期は運動を開始してから6ヶ月未満の期間です。6ヶ月以上継続すると維持期になります。'
            },
            {
                id: 8,
                category: '安全管理・救急処置',
                question: 'AEDの使用手順で最初に行うべきことは？',
                answer: '意識と呼吸の確認',
                options: [
                    'AEDの電源を入れる',
                    '意識と呼吸の確認',
                    '胸骨圧迫を開始する',
                    '119番通報をする'
                ],
                correctIndex: 1,
                difficulty: 'medium',
                explanation: '一次救命処置では、まず意識と正常な呼吸の確認を行い、心停止を判断します。'
            },
            {
                id: 9,
                category: '運動生理学',
                question: '乳酸性作業閾値（LT）が示すものは？',
                answer: '有酸素運動から無酸素運動への移行点',
                options: [
                    '最大酸素摂取量の値',
                    '有酸素運動から無酸素運動への移行点',
                    '心拍数の最大値',
                    '筋力の最大発揮点'
                ],
                correctIndex: 1,
                difficulty: 'hard',
                explanation: 'LTは血中乳酸濃度が急激に上昇し始める運動強度で、有酸素運動の上限の目安となります。'
            },
            {
                id: 10,
                category: '解剖学・運動学',
                question: '肩甲骨の動きで「挙上」の反対の動きは？',
                answer: '下制',
                options: [
                    '内転',
                    '外転',
                    '下制',
                    '回旋'
                ],
                correctIndex: 2,
                difficulty: 'easy',
                explanation: '肩甲骨の挙上（上がる動き）の反対は下制（下がる動き）です。'
            },
            {
                id: 11,
                category: '栄養学・栄養指導',
                question: '運動後30分以内の栄養摂取で重要とされる糖質とタンパク質の比率は？',
                answer: '3:1',
                options: [
                    '1:1',
                    '2:1',
                    '3:1',
                    '4:1'
                ],
                correctIndex: 2,
                difficulty: 'hard',
                explanation: '運動後のゴールデンタイムでは糖質:タンパク質=3:1の比率が筋グリコーゲンの回復と筋タンパク質合成に効果的とされています。'
            },
            {
                id: 12,
                category: '運動処方・プログラム設計',
                question: 'FITT-VPの原則で「T」が示すものは？',
                answer: 'Time（時間）',
                options: [
                    'Type（種類）',
                    'Time（時間）',
                    'Target（目標）',
                    'Training（トレーニング）'
                ],
                correctIndex: 1,
                difficulty: 'medium',
                explanation: 'FITT-VPは Frequency（頻度）、Intensity（強度）、Time（時間）、Type（種類）、Volume（量）、Progression（進歩）を表します。'
            },
            {
                id: 13,
                category: '疾病予防・健康管理',
                question: '高血圧の基準値（収縮期血圧）は？',
                answer: '140mmHg以上',
                options: [
                    '120mmHg以上',
                    '130mmHg以上',
                    '140mmHg以上',
                    '150mmHg以上'
                ],
                correctIndex: 2,
                difficulty: 'easy',
                explanation: '高血圧の基準は収縮期血圧140mmHg以上、または拡張期血圧90mmHg以上です。'
            },
            {
                id: 14,
                category: 'トレーニング科学',
                question: '筋肥大を目的とした筋力トレーニングの適切な負荷強度は？',
                answer: '1RMの70-85%',
                options: [
                    '1RMの50-60%',
                    '1RMの70-85%',
                    '1RMの90-95%',
                    '1RMの40-50%'
                ],
                correctIndex: 1,
                difficulty: 'medium',
                explanation: '筋肥大には1RMの70-85%の負荷で8-12回程度の反復が効果的とされています。'
            },
            {
                id: 15,
                category: '心理学・行動変容',
                question: '自己効力感（セルフエフィカシー）を高める方法で最も効果的とされるのは？',
                answer: '成功体験を積む',
                options: [
                    '他者の成功を観察する',
                    '言葉による説得',
                    '成功体験を積む',
                    '生理的状態の改善'
                ],
                correctIndex: 2,
                difficulty: 'hard',
                explanation: 'バンデューラの自己効力感理論では、遂行行動の達成（成功体験）が最も強力な効力感の源泉とされています。'
            }
        ];

        // ゲーム状態
        let gameBoard = [];
        let currentCell = null;
        let completedCells = new Set();
        let bingoLines = [];
        let gameComplete = false;
        let selectedAnswer = null;
        let score = 0;
        let attempts = 0;

        // ビンゴパターン
        const bingoPatterns = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // 横
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // 縦
            [0, 4, 8], [2, 4, 6] // 斜め
        ];

        // カテゴリ色の定義
        const getCategoryColor = (category) => {
            const colors = {
                '運動生理学': 'bg-red-100 text-red-800',
                '解剖学・運動学': 'bg-blue-100 text-blue-800',
                '栄養学・栄養指導': 'bg-green-100 text-green-800',
                '運動処方・プログラム設計': 'bg-purple-100 text-purple-800',
                '疾病予防・健康管理': 'bg-yellow-100 text-yellow-800',
                'トレーニング科学': 'bg-indigo-100 text-indigo-800',
                '心理学・行動変容': 'bg-pink-100 text-pink-800',
                '安全管理・救急処置': 'bg-orange-100 text-orange-800'
            };
            return colors[category] || 'bg-gray-100 text-gray-800';
        };

        // 難易度色の定義
        const getDifficultyColor = (difficulty) => {
            switch(difficulty) {
                case 'easy': return 'border-green-300 bg-green-50';
                case 'medium': return 'border-yellow-300 bg-yellow-50';
                case 'hard': return 'border-red-300 bg-red-50';
                default: return 'border-gray-300 bg-gray-50';
            }
        };

        // ゲーム初期化
        function initializeGame() {
            gameBoard = [...allCards].sort(() => Math.random() - 0.5).slice(0, 9);
            completedCells = new Set();
            bingoLines = [];
            gameComplete = false;
            currentCell = null;
            selectedAnswer = null;
            score = 0;
            attempts = 0;
            
            updateScoreDisplay();
            renderBingoBoard();
            showWaitingState();
            document.getElementById('bingo-celebration').classList.add('hidden');
        }

        // スコア表示更新
        function updateScoreDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('attempts').textContent = attempts;
            document.getElementById('bingo-lines').textContent = bingoLines.length;
            const accuracy = attempts > 0 ? Math.round((score / attempts) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // ビンゴボード描画
        function renderBingoBoard() {
            const board = document.getElementById('bingo-board');
            board.innerHTML = '';
            
            gameBoard.forEach((card, index) => {
                const cell = document.createElement('div');
                const isCompleted = completedCells.has(index);
                const isSelected = currentCell === index;
                
                cell.className = `
                    aspect-square p-4 rounded-xl border-2 cursor-pointer transition-all duration-300 cell-hover
                    ${isCompleted ? 'cell-completed' : 
                      isSelected ? 'cell-selected' : 
                      getDifficultyColor(card.difficulty)}
                `;
                
                if (isCompleted) {
                    cell.innerHTML = `
                        <div class="h-full flex flex-col items-center justify-center text-center">
                            <div class="space-y-2">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20,6 9,17 4,12"/>
                                </svg>
                                <div class="text-xs font-medium">正解！</div>
                            </div>
                        </div>
                    `;
                } else {
                    cell.innerHTML = `
                        <div class="h-full flex flex-col items-center justify-center text-center">
                            <div class="space-y-2">
                                <div class="text-xs px-2 py-1 rounded-full font-medium ${getCategoryColor(card.category)}">
                                    ${card.category}
                                </div>
                                <div class="text-xs text-gray-600 leading-tight">
                                    問題 ${index + 1}
                                </div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-500">
                                    <path d="M9 12l2 2 4-4"/>
                                    <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9"/>
                                </svg>
                            </div>
                        </div>
                    `;
                }
                
                cell.addEventListener('click', () => handleCellClick(index));
                board.appendChild(cell);
            });
        }

        // セルクリック処理
        function handleCellClick(index) {
            if (completedCells.has(index) || currentCell !== null) return;
            
            currentCell = index;
            selectedAnswer = null;
            renderBingoBoard();
            showQuestionState();
        }

        // 待機状態表示
        function showWaitingState() {
            document.getElementById('waiting-state').classList.remove('hidden');
            document.getElementById('question-state').classList.add('hidden');
            document.getElementById('result-state').classList.add('hidden');
        }

        // 問題状態表示
        function showQuestionState() {
            if (currentCell === null) return;
            
            const card = gameBoard[currentCell];
            
            // タグ表示
            const tagsContainer = document.getElementById('question-tags');
            tagsContainer.innerHTML = `
                <span class="px-3 py-1 rounded-full text-xs font-medium ${getCategoryColor(card.category)}">
                    ${card.category}
                </span>
                <span class="px-3 py-1 rounded-full text-xs font-medium ${
                    card.difficulty === 'easy' ? 'bg-green-100 text-green-800' :
                    card.difficulty === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-red-100 text-red-800'
                }">
                    ${card.difficulty === 'easy' ? '基本' :
                      card.difficulty === 'medium' ? '標準' : '上級'}
                </span>
            `;
            
            // 問題表示
            document.getElementById('question-title').textContent = `問題 ${currentCell + 1}`;
            document.getElementById('question-text').textContent = card.question;
            
            // 選択肢表示
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            card.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'w-full p-4 text-left rounded-lg border-2 option-button border-gray-200 bg-gray-50';
                button.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center text-sm font-bold">
                            ${String.fromCharCode(65 + index)}
                        </span>
                        ${option}
                    </div>
                `;
                
                button.addEventListener('click', () => handleAnswerSelect(index, button));
                optionsContainer.appendChild(button);
            });
            
            // 回答ボタン
            const submitButton = document.getElementById('submit-answer');
            submitButton.disabled = true;
            submitButton.addEventListener('click', submitAnswer);
            
            document.getElementById('waiting-state').classList.add('hidden');
            document.getElementById('question-state').classList.remove('hidden');
            document.getElementById('result-state').classList.add('hidden');
        }

        // 回答選択処理
        function handleAnswerSelect(answerIndex, buttonElement) {
            selectedAnswer = answerIndex;
            
            // 全ボタンのスタイルリセット
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.className = 'w-full p-4 text-left rounded-lg border-2 option-button border-gray-200 bg-gray-50';
                const circle = btn.querySelector('span');
                circle.className = 'w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center text-sm font-bold';
            });
            
            // 選択されたボタンのスタイル変更
            buttonElement.className = 'w-full p-4 text-left rounded-lg border-2 option-button option-selected';
            const circle = buttonElement.querySelector('span');
            circle.className = 'w-6 h-6 rounded-full border-2 border-green-500 bg-green-500 text-white flex items-center justify-center text-sm font-bold';
            
            document.getElementById('submit-answer').disabled = false;
        }

        // 回答提出処理
        function submitAnswer() {
            if (selectedAnswer === null || currentCell === null) return;
            
            const card = gameBoard[currentCell];
            const correct = selectedAnswer === card.correctIndex;
            attempts++;
            
            if (correct) {
                score++;
                completedCells.add(currentCell);
            }
            
            updateScoreDisplay();
            checkBingo();
            showResultState(correct, card.answer, card.explanation);
        }

        // 結果状態表示
        function showResultState(isCorrect, correctAnswer, explanation) {
            const resultContent = document.getElementById('result-content');
            const resultIcon = document.getElementById('result-icon');
            const explanationDiv = document.getElementById('explanation');
            
            if (isCorrect) {
                resultContent.className = 'p-6 rounded-xl text-center bg-green-100 border-2 border-green-300';
                resultIcon.innerHTML = `
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>
                    <h4 class="text-xl font-bold text-green-800">正解！</h4>
                `;
            } else {
                resultContent.className = 'p-6 rounded-xl text-center bg-red-100 border-2 border-red-300';
                resultIcon.innerHTML = `
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600">
                        <path d="M18 6 6 18"/>
                        <path d="m6 6 12 12"/>
                    </svg>
                    <h4 class="text-xl font-bold text-red-800">不正解</h4>
                `;
            }
            
            document.getElementById('correct-answer').textContent = correctAnswer;
            explanationDiv.querySelector('p').textContent = explanation;
            document.getElementById('next-question').addEventListener('click', nextQuestion);
            
            document.getElementById('waiting-state').classList.add('hidden');
            document.getElementById('question-state').classList.add('hidden');
            document.getElementById('result-state').classList.remove('hidden');
        }

        // 次の問題へ
        function nextQuestion() {
            currentCell = null;
            selectedAnswer = null;
            renderBingoBoard();
            showWaitingState();
        }

        // ビンゴチェック
        function checkBingo() {
            const newBingoLines = [];
            bingoPatterns.forEach((pattern, index) => {
                if (pattern.every(cell => completedCells.has(cell))) {
                    newBingoLines.push(index);
                }
            });
            
            bingoLines = newBingoLines;
            updateScoreDisplay();
            
            if (bingoLines.length > 0 && !gameComplete) {
                gameComplete = true;
                showBingoCelebration();
            }
        }

        // ビンゴ達成表示
        function showBingoCelebration() {
            const celebration = document.getElementById('bingo-celebration');
            const message = document.getElementById('bingo-message');
            const finalAccuracy = document.getElementById('final-accuracy');
            
            message.textContent = `おめでとうございます！${bingoLines.length}ライン完成！健康運動指導士として素晴らしい知識です！`;
            finalAccuracy.textContent = `正答率: ${Math.round((score / attempts) * 100)}%`;
            
            celebration.classList.remove('hidden');
        }

        // イベントリスナー設定
        document.getElementById('new-game').addEventListener('click', initializeGame);

        // ゲーム開始
        initializeGame();
    </script>
</body>
</html>